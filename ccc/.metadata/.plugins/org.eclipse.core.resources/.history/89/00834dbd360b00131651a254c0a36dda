require 'rubygems'
require 'anemone'

class Crawler
  Anemone.crawl("http://www.yahoo.co.jp/") do |anemone|
    anemone.on_every_page do |page|
      # 現在見ているページの URL を取得
      url = page.url
      put "url\t" + url
      # タイトルの取得
      title = page.doc.xpath("//head/title/text()").first.to_s if page.doc
      put "title\t" + title
      # 文字コードの取得
      char_code = page.doc.xpath("//head//meta[1]/@content")
      put "char_code\t" + char_code
      # リンクの URL のリストを取得
      link_list = page.links()
      link_list.each {|link|
        puts "link," + url.to_s + "," + link.to_s
      }
      page_info = PageInfo.new(url,"","",link_list)
    end
  end
end